<app-back-button></app-back-button>

<div class="page fade-in">
  <div class="container-fluid px-0">
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex align-items-center">
          <h2 class="page-title mb-0">Ricerca File</h2>
        </div>
      </div>
    </div>

    @if(servers().length > 0) {
      <div class="row">
        <div class="col-12">
          <div class="search-card">
            <!-- Search Form Component -->
            <app-search-form
              [servers]="servers()"
              [searchText]="searchText()"
              [searchingServers]="searchingServers()"
              [searchOnAllServers]="searchOnAllServers()"
              [searchInProgress]="searchInProgress()"
              (searchTextChange)="onSearchTextChange($event)"
              (searchingServersChange)="onSearchingServersChange($event)"
              (searchOnAllServersChange)="onSearchOnAllServersChange($event)"
              (search)="search()"
              (serverGroupClick)="onServerGroupClicked($event)"
            ></app-search-form>
          </div>
        </div>
      </div>

      <!-- Search Progress Component -->
      <div class="row mt-3">
        <div class="col-12">
          <app-search-progress
            [percentageDone]="percentageDone()"
            [isVisible]="percentageDone() > 0 && percentageDone() < 100"
          ></app-search-progress>
        </div>
      </div>

      <!-- Search Results Component -->
      <div class="row mt-3">
        <div class="col-12">
          <div class="results-wrapper">
            <app-search-results
              [results]="results()"
              [pageSize]="pageSize()"
              (pageSizeChange)="onPageSizeChange($event)"
              (downloadRequest)="onDownloadRequest($event)"
            ></app-search-results>
          </div>
        </div>
      </div>
    } @else {
      <div class="row">
        <div class="col-12 text-center py-5">
          <div class="loading-container">
            <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="4"></p-progressSpinner>
            <h3 class="mt-4">Caricamento server in corso...</h3>
            <p class="text-muted">Attendere il completamento dell'operazione</p>
          </div>
        </div>
      </div>
    }
  </div>
</div>